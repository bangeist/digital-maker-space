{var component={name:"crud_app",ccm:"https://ccmjs.github.io/ccm/ccm.js",config:{html:{main:{id:"main",inner:[{id:"builder"},{id:"buttons",class:"text-center",inner:{class:"btn-group",inner:[{id:"button-create",class:"btn btn-primary",onclick:"%onCreate%",inner:"Create"},{id:"button-read",class:"btn btn-default",onclick:"%onRead%",inner:"Read"},{id:"button-update",class:"btn btn-primary disabled",onclick:"%onUpdate%",inner:"Update"},{id:"button-delete",class:"btn btn-danger disabled",onclick:"%onDelete%",inner:"Delete"}]}},{id:"advance",class:"container-fluid"}]},usage:{id:"usage",inner:[{tag:"p",id:"success",class:"lead text-success",inner:"Saved successfully"},{tag:"legend",class:"text-primary",inner:"How can you use the App?"},{tag:"p",class:"text-info",inner:["Add the following ",{tag:"code",inner:"EMBED CODE"}," to your page:"]},{tag:"p",inner:{tag:"code",id:"embed_code"}},{tag:"legend",class:"text-primary",inner:"If you want to change the created App..."},{tag:"p",class:"alert alert-info",role:"alert",inner:[{tag:"span",class:"glyphicon glyphicon-exclamation-sign"}," Note this ID: ",{tag:"span",class:"text-danger",id:"id"}]}]},read:{id:"read",inner:[{tag:"legend",class:"text-primary",inner:"Loading an existing App"},{tag:"p",class:"text-info",inner:"Give here your App Identifier:"},{class:"input-group",inner:[{tag:"input",id:"key",class:"form-control",type:"text",placeholder:"App-ID..."},{tag:"span",class:"input-group-btn",inner:{tag:"button",id:"button-load",class:"btn btn-info",onclick:"%loadApp%",inner:"Load App"}}]},{tag:"p",id:"failed",class:"text-danger hidden",inner:"App-ID not found"}]},loaded:{id:"loaded",inner:{tag:"p",id:"success",class:"lead text-success",inner:"App was loaded successfully."}},deleted:{id:"deleted",inner:{tag:"p",id:"success",class:"lead text-danger",inner:"App was deleted successfully."}}},css:["ccm.load","https://ccmjs.github.io/tkless-components/libs/bootstrap/css/bootstrap.css",{context:"head",url:"https://ccmjs.github.io/tkless-components/libs/bootstrap/css/font-face.css"}],builder:["ccm.component","../cloze_builder/ccm.cloze_builder.js",{submit_button:false}],url:"../cloze/ccm.cloze.js",store:["ccm.store"],warning:"Are you sure you want to delete this App?"},Instance:function(){const self=this;let my;let $;let builder;this.ready=(callback=>{$=self.ccm.helper;my=$.privatize(self);self.logger&&self.logger.log("ready",$.clone(my));callback()});this.start=(callback=>{self.logger&&self.logger.log("start");$.setContent(self.element,$.html(my.html.main,{onCreate:()=>createApp(),onRead:()=>readApp(),onUpdate:()=>updateApp(),onDelete:()=>deleteApp()}));const builder_elem=self.element.querySelector("#builder");const buttons_elem=self.element.querySelector("#buttons");const advance_elem=self.element.querySelector("#advance");my.builder.start({root:builder_elem,target:["ccm.component",my.url],onchange:clearAdvance},builder_inst=>{builder=builder_inst;callback&&callback()});let app_id;const isLocalStore=Object.keys(my.store.source()).length===0;function createApp(){self.user?self.user.login(proceed):proceed();function proceed(){const config=builder.getValue();if(self.user)config._={access:"creator"};delete config.key;my.store.set(config,key=>{config.key=key;self.logger&&self.logger.log("create",$.clone(config));handoverApp(config)})}}function readApp(){self.logger&&self.logger.log("read");$.setContent(advance_elem,$.html(my.html.read,{loadApp:()=>{self.user?self.user.login(proceed):proceed();function proceed(){const key=advance_elem.querySelector("#key").value.trim();if(!key)return failed();my.store.get(key,config=>{if(!config)return failed();self.logger&&self.logger.log("load",$.clone(config));const datastore={};datastore[key]=config;my.builder.start({root:builder_elem,target:["ccm.component",my.url],data:{store:["ccm.store",datastore],key:key},onchange:clearAdvance},builder_inst=>{app_id=key;builder=builder_inst;!isLocalStore&&[...buttons_elem.querySelectorAll(".disabled")].map(button=>button.classList.remove("disabled"));$.setContent(advance_elem,$.html(my.html.loaded));fadeOut(advance_elem.querySelector("#success"));self.onchange&&self.onchange(self)})});function failed(){const failed_elem=advance_elem.querySelector("#failed");failed_elem.classList.remove("hidden");fadeOut(failed_elem)}}}}))}function updateApp(){if(!app_id||isLocalStore)return;self.user?self.user.login(proceed):proceed();function proceed(){const config=builder.getValue();config.key=app_id;self.logger&&self.logger.log("update",$.clone(config));my.store.set(config,()=>handoverApp(config))}}function deleteApp(){if(!app_id||isLocalStore||!confirm(my.warning))return;self.user?self.user.login(proceed):proceed();function proceed(){self.logger&&self.logger.log("delete",app_id);my.store.del(app_id,()=>{self.onchange&&self.onchange(self);app_id=undefined;$.setContent(advance_elem,$.html(my.html.deleted));fadeOut(advance_elem.querySelector("#success"));buttons_elem.querySelector("#button-update").classList.add("disabled");buttons_elem.querySelector("#button-delete").classList.add("disabled")})}}function handoverApp(config){app_id=config.key;!isLocalStore&&[...buttons_elem.querySelectorAll(".disabled")].map(button=>button.classList.remove("disabled"));$.setContent(advance_elem,$.html(my.html.usage));const store_settings=my.store.source();if(isLocalStore)store_settings[config.key]=config;advance_elem.querySelector("#embed_code").innerHTML=getEmbedCode(my.url,$.getIndex(my.url),store_settings,config.key);advance_elem.querySelector("#id").innerHTML=config.key;fadeOut(advance_elem.querySelector("#success"));self.onchange&&self.onchange(self);function getEmbedCode(url,index,store_settings,key){return $.escapeHTML('<script src="'+my.url+'"><\/script><ccm-'+index+' key=\'["ccm.get",'+JSON.stringify(store_settings)+',"'+key+"\"]'></ccm-"+index+">")}}function fadeOut(elem){elem.style.opacity=1;(function fade(){if((elem.style.opacity-=.005)>=0)requestAnimationFrame(fade)})()}function clearAdvance(){$.setContent(advance_elem,"")}});this.getValue=(()=>builder&&builder.getValue&&builder.getValue()||null)}};function p(){window.ccm[v].component(component)}const f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{const n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{const e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}}