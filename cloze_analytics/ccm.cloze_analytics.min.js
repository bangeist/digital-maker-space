{var component={name:"cloze_analytics",ccm:"https://ccmjs.github.io/ccm//ccm.js",config:{html:{main:{id:"main",inner:[{id:"user"},{id:"menu"},{id:"content"}]},results:{id:"section-results",inner:[{tag:"div",id:"inputs",inner:[{id:"section-results-user-entry",class:"entry",inner:[{tag:"label",id:"section-results-user-label",for:"section-results-user-input",inner:"%user%"},{tag:"select",id:"section-results-user-input",class:"form-control",onchange:"%onchange%",inner:[{tag:"option",value:"",inner:"%show_all%"}]}]},{id:"section-results-key-entry",class:"entry",inner:[{tag:"label",id:"section-results-key-label",for:"section-results-key-input",inner:"%cloze%"},{tag:"select",id:"section-results-key-input",class:"form-control",onchange:"%onchange%",inner:[{tag:"option",value:"",inner:"%show_all%"}]}]}]},{id:"table"}]},details:{id:"details",inner:[{id:"back1",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"back2",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"cloze"},{id:"back3",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"back4",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]}]}},css:["ccm.load","https://ccmjs.github.io/tkless-components/libs/bootstrap/css/bootstrap.css",{context:"head",url:"https://ccmjs.github.io/tkless-components/libs/bootstrap/css/font-face.css"},"https://ccmjs.github.io/akless-components/cloze_analytics/resources/default.css"],sections:{},menu:["ccm.instance","https://ccmjs.github.io/akless-components/menu/versions/ccm.menu-1.0.0.js",["ccm.get","https://ccmjs.github.io/akless-components/menu/resources/configs.js","bootstrap"]],cloze:{component:["ccm.component","https://ccmjs.github.io/akless-components/cloze/ccm.cloze.js"],configs:["ccm.store"],results:["ccm.store"]},placeholder:{user:"User",cloze:"Fill-in-the-Blank Text",show_all:"Show All",details:"Details",table_head:["User","Fill-in-the-Blank Text","Correct","Result","Created","Last Update",""]}},Instance:function(){const self=this;let my;let $;this.init=(callback=>{$=self.ccm.helper;if(self.user)self.user.onchange=(()=>self.start());callback()});this.ready=(callback=>{my=$.privatize(self);self.logger&&self.logger.log("ready",$.clone(my));callback()});this.start=(callback=>{self.logger&&self.logger.log("start");const main_elem=$.html(my.html.main);self.user?self.user.start(()=>{$.setContent(main_elem.querySelector("#user"),self.user.root);proceed()}):proceed();function proceed(){const content_elem=main_elem.querySelector("#content");const sections={results:()=>{my.cloze.results.get("{}",results=>{$.setContent(content_elem,$.html(my.html.results,{user:my.placeholder.user,cloze:my.placeholder.cloze,show_all:my.placeholder.show_all,onchange:updateTable}));const user_elem=content_elem.querySelector("#section-results-user-input");const key_elem=content_elem.querySelector("#section-results-key-input");results.map(result=>{if(!Array.isArray(result.key)||result.key.length<2)return;if(!content_elem.querySelector('#section-results-user-input option[value="'+result.key[0]+'"]'))$.append(user_elem,$.html({tag:"option",value:result.key[0],inner:result.key[0]}));if(!content_elem.querySelector('#section-results-key-input  option[value="'+result.key[1]+'"]'))$.append(key_elem,$.html({tag:"option",value:result.key[1],inner:result.key[1]}))});content_elem.querySelector("option:only-child")?$.setContent(content_elem,"Nothing to display."):updateTable();function updateTable(){const user_value=user_elem.value;const key_value=key_elem.value;let query;if(user_value&&!key_value)query={_id:{$regex:"^"+user_value+","}};else if(!user_value&&key_value)query={_id:{$regex:","+key_value+"(,|$)"}};else if(user_value&&key_value)query={_id:{$regex:"^"+user_value+","+key_value+"(,|$)"}};else query="{}";my.cloze.results.get(query,results=>{const values=[];results.map(result=>{const row=[user_value,key_value,0,"",result.created_at,result.updated_at,"<a>"];result.details.map(detail=>detail.correct&&row[2]++);row[3]=Math.round(row[2]*100/result.details.length)+"%";row[2]=row[2]+"/"+result.details.length;if(Array.isArray(result.key)){row[1]=result.key[1];row[0]=result.key[0]}values.push(row)});my.table.start({root:content_elem.querySelector("#table"),table_head:my.placeholder.table_head,data:{values:values}},instance=>{[...instance.element.querySelectorAll("a")].map((button_elem,i)=>{button_elem.innerHTML=my.placeholder.details;button_elem.classList.add("btn","btn-primary","btn-xs");button_elem.addEventListener("click",()=>{main_elem.style.display="none";my.cloze.configs.get(results[i].key[1],config=>{const details_elem=$.html(my.html.details,{onclick:()=>{$.removeElement(details_elem);main_elem.style.display="block"}});Object.assign(config,{root:details_elem.querySelector("#cloze"),data:results[i],feedback:true,retry:false,solutions:false});delete config.onfinish;delete config.time;my.cloze.comp.start(config,cloze_inst=>{const submit_button=cloze_inst.element.querySelector("#submit > *");cloze_inst.element.querySelector("#submit > *").click();$.removeElement(submit_button)});$.append(self.element,details_elem)})})})})})}})}};const entries=[];for(const key in my.sections)entries.push({title:my.sections[key],actions:event_data=>{$.setContent(content_elem,"");!event_data.selected&&sections[key]()}});$.setContent(main_elem.querySelector("#menu"),self.menu.root);self.menu.data={entries:entries};self.menu.start(()=>{$.setContent(self.element,main_elem);callback&&callback()})}})}};function p(){window.ccm[v].component(component)}const f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{const n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{const e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}}