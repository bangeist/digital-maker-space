{var component={name:"cloze_analytics",ccm:"https://ccmjs.github.io/ccm/ccm.js",config:{html:{main:{id:"main",inner:[{id:"user"},{id:"menu"},{id:"section"}]},section:{inner:[{id:"inputs"},{id:"content"}]},entry:{id:"%entry%-entry",class:"entry",inner:[{tag:"label",id:"%entry%-label",for:"%entry%-input",inner:"%label%"},{tag:"select",id:"%entry%-input",class:"form-control",onchange:"%onchange%",inner:[{tag:"option",value:"",inner:"%first%"}]}]},details:{id:"details",inner:[{id:"back1",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"back2",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"cloze"},{id:"back3",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]},{id:"back4",class:"btn btn-default",onclick:"%onclick%",inner:[{tag:"span",class:"glyphicon glyphicon-arrow-left"},"Back"]}]}},css:["ccm.load","https://ccmjs.github.io/tkless-components/libs/bootstrap/css/bootstrap.css",{context:"head",url:"https://ccmjs.github.io/tkless-components/libs/bootstrap/css/font-face.css"},"https://ccmjs.github.io/akless-components/cloze_analytics/resources/default.css"],menu:["ccm.instance","https://ccmjs.github.io/akless-components/menu/versions/ccm.menu-1.0.0.js",["ccm.get","https://ccmjs.github.io/akless-components/menu/resources/configs.js","bootstrap"]],cloze:{component:["ccm.component","https://ccmjs.github.io/akless-components/cloze/versions/ccm.cloze-4.1.0.js"],configs:["ccm.store"],results:["ccm.store"]},sections:{},placeholder:{user:"User",cloze:"Fill-in-the-Blank Text",show_all:"Show All",details:"Details",table_head:["User","Fill-in-the-Blank Text","Correct","Result","Created","Last Update",""],message:"Nothing to display.",choose:"Please Choose"}},Instance:function(){const self=this;let my;let $;let elem={};this.init=(callback=>{$=self.ccm.helper;if(self.user)self.user.onchange=(()=>self.start());self.cloze.results.onchange=update;callback()});this.ready=(callback=>{my=$.privatize(self);self.logger&&self.logger.log("ready",$.clone(my));callback()});this.start=(callback=>{self.logger&&self.logger.log("start");my.cloze.results.get("{}",results=>{my.results=results;elem.main=$.html(my.html.main);elem.section=elem.main.querySelector("#section");self.user?self.user.start(()=>{$.setContent(elem.main.querySelector("#user"),self.user.root);proceed()}):proceed();function proceed(){const entries=[];for(const key in my.sections){entries.push({title:my.sections[key],actions:event_data=>{$.setContent(elem.section,event_data.selected?"":$.html(my.html.section));elem.inputs=elem.section.querySelector("#inputs");elem.content=elem.section.querySelector("#content");my.section=event_data.selected?"":key;update()}})}$.setContent(elem.main.querySelector("#menu"),self.menu.root);self.menu.data={entries:entries};if(my.section)self.menu.selected=Object.keys(my.sections).indexOf(my.section)+1;self.menu.start(()=>{$.setContent(self.element,elem.main);callback&&callback()})}})});function update(data){const deleted=!$.isObject(data);const key=deleted?data:data.key;let exists=false;for(let i=my.results.length-1;i>=0;i--)if(my.results[i].key===key){if(deleted)my.results.splice(i,1);else my.results[i]=data;exists=true;break}if(!exists&&!deleted)my.results.push(data);if(!my.section)return;$.setContent(elem.inputs,"");$.setContent(elem.content,"");const sections={results:()=>{addInputEntry("user","show_all",onChange);addInputEntry("cloze","show_all",onChange);elem.user=elem.inputs.querySelector("#user-input");elem.cloze=elem.inputs.querySelector("#cloze-input");fillSelectorBoxes();onChange();function onChange(){my.choosed_user=elem.user.value;my.choosed_cloze=elem.cloze.value;let query;if(my.choosed_user&&!my.choosed_cloze)query={_id:{$regex:"^"+my.choosed_user+","}};else if(!my.choosed_user&&my.choosed_cloze)query={_id:{$regex:"(^"+my.choosed_cloze+"$)|(,"+my.choosed_cloze+"(,|$))"}};else if(my.choosed_user&&my.choosed_cloze)query={_id:{$regex:"^"+my.choosed_user+","+my.choosed_cloze+"(,|$)"}};else query="{}";my.cloze.results.get(query,results=>{if(!results.length)return $.setContent(elem.content,my.placeholder.message);const values=[];results.map(result=>{const row=[my.choosed_user,my.choosed_cloze,0,"",result.created_at,result.updated_at,"<a>"];result.details.map(detail=>detail.correct&&row[2]++);row[3]=Math.round(row[2]*100/result.details.length)+"%";row[2]=row[2]+"/"+result.details.length;if(Array.isArray(result.key)){row[1]=result.key[1];row[0]=result.key[0]}else row[1]=result.key;values.push(row)});my.table.start({root:elem.content,table_head:my.placeholder.table_head,data:{values:values}},instance=>{[...instance.element.querySelectorAll("a")].map((button_elem,i)=>{button_elem.innerHTML=my.placeholder.details;button_elem.classList.add("btn","btn-primary","btn-xs");button_elem.addEventListener("click",()=>{elem.main.style.display="none";my.cloze.configs.get(Array.isArray(results[i].key)?results[i].key[1]:results[i].key,config=>{const details_elem=$.html(my.html.details,{onclick:()=>{$.removeElement(details_elem);elem.main.style.display="block"}});Object.assign(config,{root:details_elem.querySelector("#cloze"),data:results[i],feedback:true,retry:false,solutions:false});delete config.onfinish;delete config.time;my.cloze.comp.start(config,cloze_inst=>{const submit_button=cloze_inst.element.querySelector("#submit > *");cloze_inst.element.querySelector("#submit > *").click();$.removeElement(submit_button)});$.append(self.element,details_elem)})})})})})}},gaps:()=>{addInputEntry("cloze","choose",onChange);elem.cloze=elem.inputs.querySelector("#cloze-input");fillSelectorBoxes();onChange();function onChange(){my.choosed_cloze=elem.cloze.value;if(!my.choosed_cloze)return $.setContent(elem.content,"");const query={_id:{$regex:"(^"+my.choosed_cloze+"$)|(,"+my.choosed_cloze+"(,|$))"}};my.cloze.results.get(query,results=>{if(!results.length)return $.setContent(elem.content,my.placeholder.message);const categories=[];const data=[];for(let i=0;i<results[0].details.length;i++){categories[i]=results[0].details[i].gap;data[i]=0}results.map(result=>{result.details.map((detail,i)=>{if(detail.correct)data[i]++})});my.chart.start({root:elem.content,settings:{chart:{type:"column"},title:{text:""},xAxis:{categories:categories,title:{text:"Text Gap"}},yAxis:{min:0,max:results.length,title:{text:"Correct Solutions"},allowDecimals:false},tooltip:{enabled:false},legend:{enabled:false},series:[{data:data}]}})})}}};sections[my.section]();function addInputEntry(entry,first,onchange){$.append(elem.inputs,$.html(my.html.entry,{entry:entry,label:my.placeholder[entry],first:my.placeholder[first],onchange:onchange}))}function fillSelectorBoxes(){my.results.map(result=>{if(!Array.isArray(result.key))result.key=[undefined,result.key];if(elem.user&&result.key[0]&&!elem.user.querySelector('option[value="'+result.key[0]+'"]'))$.append(elem.user,$.html({tag:"option",value:result.key[0],inner:result.key[0],selected:result.key[0]===my.choosed_user}));if(!elem.cloze.querySelector('option[value="'+result.key[1]+'"]'))$.append(elem.cloze,$.html({tag:"option",value:result.key[1],inner:result.key[1],selected:result.key[1]===my.choosed_cloze}))})}}}};function p(){window.ccm[v].component(component)}const f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{const n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{const e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}}